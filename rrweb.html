<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>RRWeb æ— æ„Ÿå½•å±æ¼”ç¤º</title>
    <!-- å¼•å…¥ rrweb-player æ ·å¼ -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/rrweb-player@latest/dist/style.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
        }

        .description {
            color: #666;
            font-size: 18px;
        }

        .section {
            margin-bottom: 40px;
        }

        h2 {
            color: #444;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .demo-content {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 30px;
            margin-bottom: 20px;
            background: #f9f9f9;
        }

        .video-demo {
            text-align: center;
            margin: 20px 0;
        }

        video {
            max-width: 100%;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .control-panel {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #48bb78;
            color: white;
        }

        .btn-secondary:hover {
            background: #38a169;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #f56565;
            color: white;
        }

        .btn-danger:hover {
            background: #e53e3e;
            transform: translateY(-2px);
        }

        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            display: none;
        }

        .recording {
            background: #fed7d7;
            color: #c53030;
            display: block;
        }

        .replaying {
            background: #c6f6d5;
            color: #22543d;
            display: block;
        }

        #replay-container {
            width: 100%;
            height: 500px;
            border: 2px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            margin-top: 20px;
            display: none;
        }

        .interactive-area {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }

        .form-group {
            flex: 1;
        }

        input,
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
        }

        .interactions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .interaction-btn {
            padding: 8px 16px;
            background: #edf2f7;
            color: #4a5568;
        }

        .interaction-btn:hover {
            background: #e2e8f0;
        }

        .info-box {
            background: #ebf8ff;
            border: 1px solid #bee3f8;
            color: #2c5282;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .icon {
            width: 20px;
            height: 20px;
            display: inline-block;
        }

        .record-icon {
            background: radial-gradient(circle at center, #f56565 40%, transparent 40%);
            border-radius: 50%;
        }

        .play-icon {
            border-left: 10px solid #48bb78;
            border-top: 6px solid transparent;
            border-bottom: 6px solid transparent;
        }

        .stop-icon {
            background: #4a5568;
            width: 10px;
            height: 10px;
        }

        @media (max-width: 768px) {
            .control-panel {
                flex-direction: column;
            }

            button {
                width: 100%;
            }

            .interactive-area {
                flex-direction: column;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>ğŸ¥ RRWeb æ— æ„Ÿå½•å±æ¼”ç¤º</h1>
            <p class="description">æ¼”ç¤ºå¦‚ä½•åœ¨ç”¨æˆ·æ— æ„ŸçŸ¥çš„æƒ…å†µä¸‹å½•åˆ¶ç½‘é¡µæ“ä½œï¼Œå¹¶ç²¾ç¡®å›æ”¾</p>
        </header>

        <div class="section">
            <h2>ğŸ“ å¯äº¤äº’æ¼”ç¤ºåŒºåŸŸ</h2>
            <div class="demo-content">
                <p>è¯·åœ¨æ­¤åŒºåŸŸè¿›è¡Œä»»æ„æ“ä½œï¼Œæ‰€æœ‰äº¤äº’éƒ½ä¼šè¢«å½•åˆ¶ï¼š</p>

                <div class="interactive-area">
                    <div class="form-group">
                        <label for="nameInput">å§“åï¼š</label>
                        <input type="text" id="nameInput" placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å">
                    </div>

                    <div class="form-group">
                        <label for="colorSelect">é€‰æ‹©é¢œè‰²ï¼š</label>
                        <select id="colorSelect">
                            <option value="">è¯·é€‰æ‹©</option>
                            <option value="red">çº¢è‰²</option>
                            <option value="green">ç»¿è‰²</option>
                            <option value="blue">è“è‰²</option>
                            <option value="yellow">é»„è‰²</option>
                        </select>
                    </div>
                </div>

                <div class="interactions">
                    <button class="interaction-btn" onclick="addItem()">â• æ·»åŠ é¡¹ç›®</button>
                    <button class="interaction-btn" onclick="changeColor()">ğŸ¨ éšæœºèƒŒæ™¯è‰²</button>
                    <button class="interaction-btn" onclick="showMessage()">ğŸ’¬ æ˜¾ç¤ºæ¶ˆæ¯</button>
                    <button class="interaction-btn" onclick="clearItems()">ğŸ—‘ï¸ æ¸…ç©ºåˆ—è¡¨</button>
                </div>

                <div id="itemList" style="margin-top: 20px;"></div>

                <div class="video-demo">
                    <p><strong>è§†é¢‘æ’­æ”¾å™¨æµ‹è¯•ï¼š</strong></p>
                    <video id="demoVideo" controls width="400">
                        <source src="https://www.w3school.com.cn/i/video/shanghai.mp4"
                            type="video/mp4">
                        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒ video æ ‡ç­¾ã€‚
                    </video>
                    <p style="margin-top: 10px; font-size: 14px; color: #666;">
                        * rrweb èƒ½å½•åˆ¶è§†é¢‘äº¤äº’çŠ¶æ€ï¼ˆæ’­æ”¾/æš‚åœ/è·³è½¬ï¼‰ï¼Œä½†å›æ”¾ä¾èµ–åŸå§‹è§†é¢‘æºå¯è®¿é—®
                    </p>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>ğŸ›ï¸ å½•åˆ¶æ§åˆ¶é¢æ¿</h2>
            <div class="control-panel">
                <button class="btn-primary" onclick="startRecording()">
                    <span class="icon record-icon"></span>
                    å¼€å§‹æ— æ„Ÿå½•åˆ¶
                </button>
                <button class="btn-secondary" onclick="startRecordingWithCanvas()">
                    <span class="icon record-icon"></span>
                    å½•åˆ¶ï¼ˆå«Canvasæ•è·ï¼‰
                </button>
                <button class="btn-secondary" onclick="stopRecording()">
                    <span class="icon stop-icon"></span>
                    åœæ­¢å½•åˆ¶
                </button>
                <button class="btn-danger" onclick="replayRecording()" id="replayBtn" disabled>
                    <span class="icon play-icon"></span>
                    å›æ”¾å½•åˆ¶å†…å®¹
                </button>
            </div>

            <div id="statusRecording" class="status recording">
                ğŸ”´ æ­£åœ¨å½•åˆ¶ä¸­... è¯·åœ¨ä¸Šæ–¹åŒºåŸŸè¿›è¡Œæ“ä½œï¼Œæ‰€æœ‰äº¤äº’éƒ½ä¼šè¢«è®°å½•
            </div>

            <div id="statusReplaying" class="status replaying">
                â–¶ï¸ æ­£åœ¨å›æ”¾ä¸­...
            </div>

            <div class="info-box">
                <strong>ğŸ’¡ æŠ€æœ¯è¯´æ˜ï¼š</strong>
                <ul style="margin-top: 8px; padding-left: 20px;">
                    <li>å½•åˆ¶æ˜¯<strong>å®Œå…¨æ— æ„Ÿ</strong>çš„ï¼Œç”¨æˆ·ä¸ä¼šæ”¶åˆ°ä»»ä½•æç¤º</li>
                    <li>æ•°æ®å­˜å‚¨åœ¨æµè§ˆå™¨å†…å­˜ä¸­ï¼Œå®é™…åº”ç”¨éœ€å‘é€åˆ°æœåŠ¡å™¨</li>
                    <li>è§†é¢‘äº¤äº’ï¼ˆæ’­æ”¾/æš‚åœ/è·³è½¬ï¼‰ä¼šè¢«å½•åˆ¶ï¼Œä½†å›æ”¾æ—¶ç”»é¢ä¾èµ–åŸå§‹è§†é¢‘æº</li>
                    <li>å«Canvasæ•è·æ¨¡å¼èƒ½å½•åˆ¶è§†é¢‘ç”»é¢ï¼Œä½†æ•°æ®é‡ä¼šæ˜¾è‘—å¢åŠ </li>
                </ul>
            </div>
        </div>

        <div class="section">
            <h2>ğŸ“º å›æ”¾å±•ç¤ºåŒº</h2>
            <div id="replay-container"></div>
        </div>
    </div>

    <!-- å¼•å…¥ rrweb ç›¸å…³åº“ -->
    <script src="https://cdn.jsdelivr.net/npm/rrweb@latest/dist/rrweb.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/rrweb-player@latest/dist/index.js"></script>

    <script>
        // å­˜å‚¨å½•åˆ¶äº‹ä»¶å’ŒçŠ¶æ€
        let events = [];
        let stopRecordingFn = null;
        let isRecording = false;
        let isReplaying = false;

        // æ¼”ç¤ºåŒºåŸŸçš„äº¤äº’å‡½æ•°
        function addItem() {
            const list = document.getElementById('itemList');
            const item = document.createElement('div');
            item.className = 'list-item';
            item.style.padding = '10px';
            item.style.margin = '5px 0';
            item.style.background = '#e2e8f0';
            item.style.borderRadius = '4px';
            item.textContent = `é¡¹ç›® ${list.children.length + 1} - ${new Date().toLocaleTimeString()}`;
            list.appendChild(item);
        }

        function changeColor() {
            const colors = ['#ffebee', '#e8f5e9', '#e3f2fd', '#fff3e0', '#f3e5f5'];
            const randomColor = colors[Math.floor(Math.random() * colors.length)];
            document.querySelector('.demo-content').style.backgroundColor = randomColor;
        }

        function showMessage() {
            alert(`è¿™æ˜¯æ¼”ç¤ºæ¶ˆæ¯ï¼Œæ—¶é—´ï¼š${new Date().toLocaleTimeString()}`);
        }

        function clearItems() {
            document.getElementById('itemList').innerHTML = '';
        }

        // å¼€å§‹åŸºæœ¬å½•åˆ¶ï¼ˆæ— æ„Ÿå½•åˆ¶ï¼‰
        function startRecording() {
            if (isRecording) return;

            // é‡ç½®äº‹ä»¶æ•°ç»„
            events = [];

            // å¼€å§‹å½•åˆ¶
            stopRecordingFn = rrweb.record({
                emit(event) {
                    // å­˜å‚¨äº‹ä»¶
                    events.push(event);
                    // å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œåº”è¯¥å°†äº‹ä»¶å‘é€åˆ°æœåŠ¡å™¨
                    // ä¾‹å¦‚ï¼šsendToServer(event);

                    // å¯ç”¨å›æ”¾æŒ‰é’®
                    if (events.length > 0) {
                        document.getElementById('replayBtn').disabled = false;
                    }
                },
                // é…ç½®é€‰é¡¹
                recordCanvas: false, // ä¸å½•åˆ¶Canvasï¼Œå‡å°‘æ•°æ®é‡
                // maskTextSelector: '*', // å±è”½æ‰€æœ‰æ–‡æœ¬å†…å®¹ï¼Œä¿æŠ¤éšç§
                maskAllInputs: true, // å±è”½æ‰€æœ‰è¾“å…¥å†…å®¹
                maskTextClass: 'rr-mask', // è‡ªå®šä¹‰å±è”½æ ·å¼ç±»
                sampling: {
                    // é‡‡æ ·é…ç½®ï¼Œä¼˜åŒ–æ€§èƒ½
                    scroll: 150, // æ¯150msæœ€å¤šé‡‡æ ·ä¸€æ¬¡æ»šåŠ¨
                    mouseInteraction: {
                        MouseUp: false,
                        MouseDown: false,
                        Click: true,
                        ContextMenu: true,
                        DblClick: true,
                        Focus: true,
                        Blur: true,
                        TouchStart: false,
                        TouchEnd: false,
                    },
                },
                // å±è”½æŸäº›å…ƒç´ 
                blockSelector: '.no-record', // æ·»åŠ  no-record ç±»åæ¥å±è”½å…ƒç´ 
                // å¿½ç•¥æŸäº›äº‹ä»¶
                ignoreSelector: '.ignore-record', // æ·»åŠ  ignore-record ç±»åæ¥å¿½ç•¥å…ƒç´ 
                // è§¦å‘å½•åˆ¶å‰çš„é’©å­
                beforeEmit(event) {
                    // å¯ä»¥åœ¨æ­¤å¤„è¿‡æ»¤æˆ–ä¿®æ”¹äº‹ä»¶
                    return event;
                },
            });

            isRecording = true;
            updateUI();
            console.log('ğŸ¥ å½•åˆ¶å·²å¼€å§‹ï¼ˆæ— æ„Ÿæ¨¡å¼ï¼‰');
        }

        // å¼€å§‹å½•åˆ¶ï¼ˆåŒ…å«Canvasæ•è·ï¼‰
        function startRecordingWithCanvas() {
            if (isRecording) return;

            events = [];

            stopRecordingFn = rrweb.record({
                emit(event) {
                    events.push(event);
                    if (events.length > 0) {
                        document.getElementById('replayBtn').disabled = false;
                    }
                },
                // å…³é”®é…ç½®ï¼šå¯ç”¨Canvaså½•åˆ¶
                recordCanvas: true, // è¿™ä¼šå½•åˆ¶Canvaså†…å®¹ï¼ˆåŒ…æ‹¬è§†é¢‘ç”»é¢ï¼‰
                // å¯è°ƒæ•´Canvaså½•åˆ¶è´¨é‡ä»¥å¹³è¡¡è´¨é‡å’Œæ€§èƒ½
                canvas: {
                    quality: 0.6, // å›¾åƒè´¨é‡ï¼Œ0-1ä¹‹é—´
                    frameRate: 24, // å¸§ç‡
                },
                maskAllInputs: true,
                sampling: {
                    scroll: 150,
                },
            });

            isRecording = true;
            updateUI();
            console.log('ğŸ¥ å½•åˆ¶å·²å¼€å§‹ï¼ˆå«Canvasæ•è·ï¼Œæ•°æ®é‡è¾ƒå¤§ï¼‰');
        }

        // åœæ­¢å½•åˆ¶
        function stopRecording() {
            if (!isRecording) return;

            if (stopRecordingFn) {
                stopRecordingFn();
            }

            isRecording = false;
            updateUI();
            console.log('â¹ï¸ å½•åˆ¶å·²åœæ­¢');
            console.log(`ğŸ“Š å½•åˆ¶äº‹ä»¶æ•°ï¼š${events.length}`);

            // æ˜¾ç¤ºå½•åˆ¶æ•°æ®ç»Ÿè®¡
            showDataStats();
        }

        // å›æ”¾å½•åˆ¶å†…å®¹
        function replayRecording() {
            if (events.length === 0 || isReplaying) {
                alert('è¯·å…ˆå½•åˆ¶ä¸€äº›å†…å®¹ï¼');
                return;
            }

            // åœæ­¢å½“å‰å½•åˆ¶ï¼ˆå¦‚æœæ­£åœ¨å½•åˆ¶ï¼‰
            if (isRecording) {
                stopRecording();
            }

            // æ˜¾ç¤ºå›æ”¾å®¹å™¨
            const container = document.getElementById('replay-container');
            container.style.display = 'block';

            // æ¸…ç©ºä¹‹å‰çš„å›æ”¾
            container.innerHTML = '';

            // åˆ›å»ºæ–°çš„å›æ”¾å®ä¾‹
            new rrwebPlayer({
                target: container,
                props: {
                    events: events,
                    width: container.clientWidth,
                    height: 500,
                    autoPlay: true,
                    showController: true,
                    speedOption: [0.5, 1, 2, 4],
                    mouseTail: true, // æ˜¾ç¤ºé¼ æ ‡è½¨è¿¹
                    unpackFn: rrweb.unpack,
                    // è‡ªå®šä¹‰å›æ”¾é€Ÿåº¦
                    speed: 1,
                    // è·³è½¬åˆ°å¼€å§‹
                    skipInactive: false,
                    // è§¦å‘æ¨¡å¼
                    triggerFocus: true,
                    // å›æ”¾å¼€å§‹æ—¶çš„é’©å­
                    onStart() {
                        isReplaying = true;
                        updateUI();
                        console.log('â–¶ï¸ å›æ”¾å¼€å§‹');
                    },
                    // å›æ”¾ç»“æŸæ—¶çš„é’©å­
                    onFinished() {
                        isReplaying = false;
                        updateUI();
                        console.log('â¹ï¸ å›æ”¾ç»“æŸ');
                    },
                },
            });

            // æ»šåŠ¨åˆ°å›æ”¾åŒºåŸŸ
            container.scrollIntoView({ behavior: 'smooth' });
        }

        // æ›´æ–°UIçŠ¶æ€
        function updateUI() {
            const recordingStatus = document.getElementById('statusRecording');
            const replayingStatus = document.getElementById('statusReplaying');

            if (isRecording) {
                recordingStatus.style.display = 'block';
                replayingStatus.style.display = 'none';
            } else if (isReplaying) {
                recordingStatus.style.display = 'none';
                replayingStatus.style.display = 'block';
            } else {
                recordingStatus.style.display = 'none';
                replayingStatus.style.display = 'none';
            }
        }

        // æ˜¾ç¤ºå½•åˆ¶æ•°æ®ç»Ÿè®¡
        function showDataStats() {
            if (events.length === 0) return;

            // è®¡ç®—æ•°æ®å¤§å°ï¼ˆè¿‘ä¼¼å€¼ï¼‰
            const dataStr = JSON.stringify(events);
            const sizeInBytes = new Blob([dataStr]).size;
            const sizeInKB = (sizeInBytes / 1024).toFixed(2);
            const sizeInMB = (sizeInBytes / (1024 * 1024)).toFixed(2);

            console.log('ğŸ“ˆ å½•åˆ¶æ•°æ®ç»Ÿè®¡:');
            console.log(`  äº‹ä»¶æ•°é‡: ${events.length}`);
            console.log(`  æ•°æ®å¤§å°: ${sizeInBytes} å­—èŠ‚ (${sizeInKB} KB)`);

            // æ˜¾ç¤ºç®€ç•¥ç»Ÿè®¡ä¿¡æ¯
            const stats = `å·²å½•åˆ¶ ${events.length} ä¸ªäº‹ä»¶ï¼Œæ•°æ®é‡çº¦ ${sizeInKB} KB`;
            alert(stats);
        }

        // æ¨¡æ‹Ÿå‘é€æ•°æ®åˆ°æœåŠ¡å™¨ï¼ˆå®é™…åº”ç”¨ä¸­çš„ç¤ºä¾‹ï¼‰
        function sendToServer(event) {
            // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œåº”è¯¥å‘é€åˆ°ä½ çš„æœåŠ¡å™¨
            // ç¤ºä¾‹ï¼šä½¿ç”¨ fetch API
            /*
            fetch('/api/record', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(event),
            })
            .then(response => response.json())
            .then(data => console.log('æ•°æ®å·²å‘é€åˆ°æœåŠ¡å™¨:', data))
            .catch(error => console.error('å‘é€å¤±è´¥:', error));
            */
        }

        // é¡µé¢å¸è½½å‰è‡ªåŠ¨åœæ­¢å½•åˆ¶
        window.addEventListener('beforeunload', () => {
            if (isRecording && stopRecordingFn) {
                stopRecordingFn();
                console.log('ğŸšª é¡µé¢å…³é—­ï¼Œå½•åˆ¶å·²è‡ªåŠ¨åœæ­¢');
            }
        });

        // åˆå§‹åŒ–
        console.log('ğŸš€ RRWeb æ¼”ç¤ºå·²åŠ è½½');
        console.log('ğŸ’¡ æç¤ºï¼šå¼€å§‹å½•åˆ¶åï¼Œè¯·åœ¨ä¸Šæ–¹æ¼”ç¤ºåŒºåŸŸè¿›è¡Œå„ç§æ“ä½œ');

        // è§†é¢‘ç›¸å…³äº‹ä»¶ç›‘å¬ï¼ˆæ¼”ç¤ºè§†é¢‘äº¤äº’å½•åˆ¶ï¼‰
        document.getElementById('demoVideo').addEventListener('play', function () {
            console.log('â–¶ï¸ è§†é¢‘å¼€å§‹æ’­æ”¾ï¼ˆæ­¤äº‹ä»¶ä¼šè¢«å½•åˆ¶ï¼‰');
        });

        document.getElementById('demoVideo').addEventListener('pause', function () {
            console.log('â¸ï¸ è§†é¢‘æš‚åœï¼ˆæ­¤äº‹ä»¶ä¼šè¢«å½•åˆ¶ï¼‰');
        });

        // æ·»åŠ ä¸€äº›åˆå§‹æ¼”ç¤ºé¡¹ç›®
        window.addEventListener('load', function () {
            // æ·»åŠ å‡ ä¸ªåˆå§‹é¡¹ç›®
            for (let i = 0; i < 3; i++) {
                setTimeout(addItem, 100 * i);
            }

            console.log('âœ… æ¼”ç¤ºé¡µé¢åˆå§‹åŒ–å®Œæˆ');
            console.log('ğŸ® ç°åœ¨å¯ä»¥ç‚¹å‡»"å¼€å§‹æ— æ„Ÿå½•åˆ¶"æŒ‰é’®ï¼Œç„¶ååœ¨ä¸Šæ–¹åŒºåŸŸè¿›è¡Œæ“ä½œ');
        });
    </script>
</body>

</html>